input: "mode: dictation\n-\n^press <user.modifiers>$: key(modifiers)\n^press <user.keys>$:\
  \ key(keys)\n\n# Everything here should call `auto_insert()` (instead of `insert()`),\
  \ to preserve the state to correctly auto-capitalize/auto-space.\n# (Talonscript\
  \ string literals implicitly call `auto_insert`, so there's no need to wrap those)\n\
  <user.raw_prose>: auto_insert(raw_prose)\ncap: user.dictation_format_cap()\n# Hyphenated\
  \ variants are for Dragon.\n(no cap | no-caps): user.dictation_format_no_cap()\n\
  (no space | no-space): user.dictation_format_no_space()\n^cap that$: user.dictation_reformat_cap()\n\
  ^(no cap | no-caps) that$: user.dictation_reformat_no_cap()\n^(no space | no-space)\
  \ that$: user.dictation_reformat_no_space()\n\n# Navigation\ngo up <number_small>\
  \ (line|lines):\n    edit.up()\n    repeat(number_small - 1)\ngo down <number_small>\
  \ (line|lines):\n    edit.down()\n    repeat(number_small - 1)\ngo left <number_small>\
  \ (word|words):\n    edit.word_left()\n    repeat(number_small - 1)\ngo right <number_small>\
  \ (word|words):\n    edit.word_right()\n    repeat(number_small - 1)\ngo line start:\
  \ edit.line_start()\ngo line end: edit.line_end()\n\n# Selection\nselect left <number_small>\
  \ (word|words):\n    edit.extend_word_left()\n    repeat(number_small - 1)\nselect\
  \ right <number_small> (word|words):\n    edit.extend_word_right()\n    repeat(number_small\
  \ - 1)\nselect left <number_small> (character|characters):\n    edit.extend_left()\n\
  \    repeat(number_small - 1)\nselect right <number_small> (character|characters):\n\
  \    edit.extend_right()\n    repeat(number_small - 1)\nclear left <number_small>\
  \ (word|words):\n    edit.extend_word_left()\n    repeat(number_small - 1)\n   \
  \ edit.delete()\nclear right <number_small> (word|words):\n    edit.extend_word_right()\n\
  \    repeat(number_small - 1)\n    edit.delete()\nclear left <number_small> (character|characters):\n\
  \    edit.extend_left()\n    repeat(number_small - 1)\n    edit.delete()\nclear\
  \ right <number_small> (character|characters):\n    edit.extend_right()\n    repeat(number_small\
  \ - 1)\n    edit.delete()\n\n# Formatting\nformatted <user.format_text>:\n    user.dictation_insert_raw(format_text)\n\
  ^format selection <user.formatters>$:\n    user.formatters_reformat_selection(formatters)\n\
  \n# Corrections\nscratch that: user.clear_last_phrase()\nscratch selection: edit.delete()\n\
  select that: user.select_last_phrase()\nspell that <user.letters>: auto_insert(letters)\n\
  spell that <user.formatters> <user.letters>:\n    result = user.formatted_text(letters,\
  \ formatters)\n    user.dictation_insert_raw(result)\n\n# Escape, type things that\
  \ would otherwise be commands\n^escape <user.text>$:\n    auto_insert(user.text)\n"
output:
  type: source_file
  children:
  - type: context
    children:
    - type: match
      key:
        text: mode
        type: identifier
      pattern:
        text: ' dictation'
        type: implicit_string
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - text: press
          type: word
        - type: capture
          capture_name:
            text: user.modifiers
            type: identifier
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: key_action
          arguments:
            text: modifiers
            type: implicit_string
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - text: press
          type: word
        - type: capture
          capture_name:
            text: user.keys
            type: identifier
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: key_action
          arguments:
            text: keys
            type: implicit_string
  - text: '# Everything here should call `auto_insert()` (instead of `insert()`),
      to preserve the state to correctly auto-capitalize/auto-space.'
    type: comment
  - text: "# (Talonscript string literals implicitly call `auto_insert`, so there's\
      \ no need to wrap those)"
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - type: capture
        capture_name:
          text: user.raw_prose
          type: identifier
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: auto_insert
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: raw_prose
                type: identifier
  - type: command
    rule:
      type: rule
      children:
      - text: cap
        type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_format_cap
            type: identifier
          arguments:
            type: argument_list
            children: []
  - text: '# Hyphenated variants are for Dragon.'
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - type: parenthesized_rule
        children:
        - type: choice
          children:
          - type: seq
            children:
            - text: no
              type: word
            - text: cap
              type: word
          - text: no-caps
            type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_format_no_cap
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: parenthesized_rule
        children:
        - type: choice
          children:
          - type: seq
            children:
            - text: no
              type: word
            - text: space
              type: word
          - text: no-space
            type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_format_no_space
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - text: cap
          type: word
        - text: that
          type: word
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_reformat_cap
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - type: seq
              children:
              - text: no
                type: word
              - text: cap
                type: word
            - text: no-caps
              type: word
        - text: that
          type: word
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_reformat_no_cap
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - type: seq
              children:
              - text: no
                type: word
              - text: space
                type: word
            - text: no-space
              type: word
        - text: that
          type: word
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_reformat_no_space
            type: identifier
          arguments:
            type: argument_list
            children: []
  - text: '# Navigation'
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: go
          type: word
        - text: up
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: line
              type: word
            - text: lines
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.up
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: go
          type: word
        - text: down
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: line
              type: word
            - text: lines
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.down
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: go
          type: word
        - text: left
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: word
              type: word
            - text: words
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.word_left
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: go
          type: word
        - text: right
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: word
              type: word
            - text: words
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.word_right
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: go
          type: word
        - text: line
          type: word
        - text: start
          type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.line_start
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: go
          type: word
        - text: line
          type: word
        - text: end
          type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.line_end
            type: identifier
          arguments:
            type: argument_list
            children: []
  - text: '# Selection'
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: select
          type: word
        - text: left
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: word
              type: word
            - text: words
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_word_left
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: select
          type: word
        - text: right
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: word
              type: word
            - text: words
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_word_right
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: select
          type: word
        - text: left
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: character
              type: word
            - text: characters
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_left
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: select
          type: word
        - text: right
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: character
              type: word
            - text: characters
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_right
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: clear
          type: word
        - text: left
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: word
              type: word
            - text: words
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_word_left
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.delete
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: clear
          type: word
        - text: right
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: word
              type: word
            - text: words
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_word_right
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.delete
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: clear
          type: word
        - text: left
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: character
              type: word
            - text: characters
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_left
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.delete
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: clear
          type: word
        - text: right
          type: word
        - type: capture
          capture_name:
            text: number_small
            type: identifier
        - type: parenthesized_rule
          children:
          - type: choice
            children:
            - text: character
              type: word
            - text: characters
              type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.extend_right
            type: identifier
          arguments:
            type: argument_list
            children: []
      - type: expression
        expression:
          type: action
          action_name:
            text: repeat
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: binary_operator
              left:
                type: variable
                variable_name:
                  text: number_small
                  type: identifier
              operator:
                text: '-'
                type: operator
              right:
                text: '1'
                type: integer
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.delete
            type: identifier
          arguments:
            type: argument_list
            children: []
  - text: '# Formatting'
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: formatted
          type: word
        - type: capture
          capture_name:
            text: user.format_text
            type: identifier
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_insert_raw
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: format_text
                type: identifier
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - text: format
          type: word
        - text: selection
          type: word
        - type: capture
          capture_name:
            text: user.formatters
            type: identifier
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.formatters_reformat_selection
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: formatters
                type: identifier
  - text: '# Corrections'
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: scratch
          type: word
        - text: that
          type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.clear_last_phrase
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: scratch
          type: word
        - text: selection
          type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: edit.delete
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: select
          type: word
        - text: that
          type: word
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: user.select_last_phrase
            type: identifier
          arguments:
            type: argument_list
            children: []
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: spell
          type: word
        - text: that
          type: word
        - type: capture
          capture_name:
            text: user.letters
            type: identifier
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: auto_insert
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: letters
                type: identifier
  - type: command
    rule:
      type: rule
      children:
      - type: seq
        children:
        - text: spell
          type: word
        - text: that
          type: word
        - type: capture
          capture_name:
            text: user.formatters
            type: identifier
        - type: capture
          capture_name:
            text: user.letters
            type: identifier
    script:
      type: block
      children:
      - type: assignment
        left:
          text: result
          type: identifier
        right:
          type: action
          action_name:
            text: user.formatted_text
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: letters
                type: identifier
            - type: variable
              variable_name:
                text: formatters
                type: identifier
      - type: expression
        expression:
          type: action
          action_name:
            text: user.dictation_insert_raw
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: result
                type: identifier
  - text: '# Escape, type things that would otherwise be commands'
    type: comment
  - type: command
    rule:
      type: rule
      children:
      - text: ^
        type: start_anchor
      - type: seq
        children:
        - text: escape
          type: word
        - type: capture
          capture_name:
            text: user.text
            type: identifier
      - text: $
        type: end_anchor
    script:
      type: block
      children:
      - type: expression
        expression:
          type: action
          action_name:
            text: auto_insert
            type: identifier
          arguments:
            type: argument_list
            children:
            - type: variable
              variable_name:
                text: user.text
                type: identifier
